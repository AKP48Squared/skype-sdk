<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Skype Bot SDK for Node.js Index</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cosmo.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top navbar-inverse">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">Skype Bot SDK for Node.js</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="AbstractModelType.html">AbstractModelType</a></li><li><a href="ActionBase.html">ActionBase</a></li><li><a href="Answer.html">Answer</a></li><li><a href="AnswerAppHostedMedia.html">AnswerAppHostedMedia</a></li><li><a href="AnswerAppHostedMediaOutcome.html">AnswerAppHostedMediaOutcome</a></li><li><a href="AnswerOutcome.html">AnswerOutcome</a></li><li><a href="Attachment.html">Attachment</a></li><li><a href="Bot.html">Bot</a></li><li><a href="BotService.html">BotService</a></li><li><a href="CallBackLink.html">CallBackLink</a></li><li><a href="CallingService.html">CallingService</a></li><li><a href="CallStateChangeNotification.html">CallStateChangeNotification</a></li><li><a href="ChoiceOutcome.html">ChoiceOutcome</a></li><li><a href="CollectDigits.html">CollectDigits</a></li><li><a href="CollectDigitsOutcome.html">CollectDigitsOutcome</a></li><li><a href="ContactNotification.html">ContactNotification</a></li><li><a href="Conversation.html">Conversation</a></li><li><a href="ConversationBase.html">ConversationBase</a></li><li><a href="ConversationResult.html">ConversationResult</a></li><li><a href="Event.html">Event</a></li><li><a href="Hangup.html">Hangup</a></li><li><a href="HangupOutcome.html">HangupOutcome</a></li><li><a href="HistoryDisclosed.html">HistoryDisclosed</a></li><li><a href="Message.html">Message</a></li><li><a href="MessagingService.html">MessagingService</a></li><li><a href="NotificationBase.html">NotificationBase</a></li><li><a href="NotificationResponse.html">NotificationResponse</a></li><li><a href="OperationOutcomeBase.html">OperationOutcomeBase</a></li><li><a href="Participant.html">Participant</a></li><li><a href="PlaceCall.html">PlaceCall</a></li><li><a href="PlaceCallOutcome.html">PlaceCallOutcome</a></li><li><a href="PlayPrompt.html">PlayPrompt</a></li><li><a href="PlayPromptOutcome.html">PlayPromptOutcome</a></li><li><a href="Prompt.html">Prompt</a></li><li><a href="RecognitionOption.html">RecognitionOption</a></li><li><a href="Recognize.html">Recognize</a></li><li><a href="RecognizeOutcome.html">RecognizeOutcome</a></li><li><a href="Record.html">Record</a></li><li><a href="RecordOutcome.html">RecordOutcome</a></li><li><a href="Reject.html">Reject</a></li><li><a href="RejectOutcome.html">RejectOutcome</a></li><li><a href="RosterParticipant.html">RosterParticipant</a></li><li><a href="RosterUpdateNotification.html">RosterUpdateNotification</a></li><li><a href="TopicUpdated.html">TopicUpdated</a></li><li><a href="TranscriptionOutcome.html">TranscriptionOutcome</a></li><li><a href="Transfer.html">Transfer</a></li><li><a href="TransferOutcome.html">TransferOutcome</a></li><li><a href="UserAdded.html">UserAdded</a></li><li><a href="UserRemoved.html">UserRemoved</a></li><li><a href="VideoSubscription.html">VideoSubscription</a></li><li><a href="VideoSubscriptionOutcome.html">VideoSubscriptionOutcome</a></li><li><a href="Workflow.html">Workflow</a></li><li><a href="WorkflowValidationOutcome.html">WorkflowValidationOutcome</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="events.list.html" class="dropdown-toggle" data-toggle="dropdown">Events<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="BotService.html#event:attachment">BotService#event:attachment</a></li><li><a href="BotService.html#event:contactAdded">BotService#event:contactAdded</a></li><li><a href="BotService.html#event:contactRemoved">BotService#event:contactRemoved</a></li><li><a href="BotService.html#event:groupMessage">BotService#event:groupMessage</a></li><li><a href="BotService.html#event:message">BotService#event:message</a></li><li><a href="BotService.html#event:personalMessage">BotService#event:personalMessage</a></li><li><a href="BotService.html#event:threadAddMember">BotService#event:threadAddMember</a></li><li><a href="BotService.html#event:threadBotAdded">BotService#event:threadBotAdded</a></li><li><a href="BotService.html#event:threadBotRemoved">BotService#event:threadBotRemoved</a></li><li><a href="BotService.html#event:threadHistoryDisclosedUpdate">BotService#event:threadHistoryDisclosedUpdate</a></li><li><a href="BotService.html#event:threadRemoveMember">BotService#event:threadRemoveMember</a></li><li><a href="BotService.html#event:threadTopicUpdated">BotService#event:threadTopicUpdated</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="global.html#incomingCallbackHandler">incomingCallbackHandler</a></li><li><a href="global.html#incomingCallHandler">incomingCallHandler</a></li><li><a href="global.html#instantiateAction">instantiateAction</a></li><li><a href="global.html#instantiateNotification">instantiateNotification</a></li><li><a href="global.html#instantiateOperationOutcome">instantiateOperationOutcome</a></li><li><a href="global.html#messagingHandler">messagingHandler</a></li>
				</ul>
			</li>
			
		</ul>
		<div class="col-sm-3 col-md-3">
            <form class="navbar-form" role="search">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                    <div class="input-group-btn">
                        <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                    </div>
                </div>
            </form>
        </div>
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-8">
	
		<div id="main">
			

	
	











	
	





    <section class="readme-section">
        <article><h1>Getting started</h1><p>Let's say you want to build an echo messaging bot.</p>
<h2>Requirements</h2><p>If you don't have them, go to the official Node.js website and install the latest versions of:</p>
<ul>
<li>Node.js and package ecosystem npm</li>
</ul>
<p>Both are available from the official page. </p>
<h2>Configuration</h2><p>Before you get started, make sure you register your bot. Also have ready your:</p>
<ul>
<li>Bot’s ID</li>
<li>Application ID If you've forgotten it, you can find your Application's ID in Details in My Bots.</li>
<li>Your Application Secret If you've misplaced your Application Secret, you'll have to generate a new one at Microsoft Applications. </li>
</ul>
<p>Create a directory for your bot and navigate to it:</p>
<pre class="prettyprint source"><code>> mkdir echo_bot
> cd echo_bot</code></pre><p>Initialize an npm project:</p>
<pre class="prettyprint source"><code>> npm init</code></pre><p>Install the dependencies:</p>
<pre class="prettyprint source"><code>> npm install --save restify</code></pre><p>Download the Skype-SDK package <a href="https://microsoft.sharepoint.com/teams/SkypeSMS/Shared%20Documents/Agents/skype-sdk.tar.gz">skype-sdk.tar.gz</a> and install it using npm:</p>
<pre class="prettyprint source"><code>> npm install --save ./skype-sdk.tar.gz</code></pre><p>Update your package.json file to include the &quot;engines&quot; attribute:</p>
<pre class="prettyprint source lang-javascript"><code>{
…
&quot;engines&quot;: {
&quot;node&quot;: &quot;>=5.6.0&quot;
},
…
}</code></pre><h2>Create server.js</h2><p>You need to create a server.js file to:</p>
<ul>
<li>Initialize the bot service</li>
<li>Initialize your bot</li>
<li>Run everything within a restify framework</li>
</ul>
<p>Let's get started.</p>
<ol>
<li>Import all the needed libraries:<ul>
<li>The restify framework</li>
<li>The Skype SDK</li>
</ul>
</li>
<li>Create new instances of:<ul>
<li>The <a href="BotService.html">BotService</a> class configured for messaging. Your APP_ID and APP_SECRET environment variables have OAuth credentials.</li>
<li>The restify server</li>
</ul>
</li>
<li>Add an event handler for <a href="BotService.html#event:contactAdded">new contacts</a> and reply with welcome message (set “escape” flag to true in your <a href="Bot.html#reply">reply</a> call, to accept invalid characters in user’s display names).</li>
<li>Add a <a href="BotService.html#event:personalMessage">personal message event handler</a> to echo and reply to incoming messages (set “escape” flag to true in your <a href="Bot.html#reply">reply</a> call, to accept invalid characters in user’s message).</li>
<li>Configure one route for incoming events.</li>
<li>Use the Skype SDK middleware functions to pass requests to BotService.<ul>
<li>POST to /v1/chat for incoming events</li>
</ul>
</li>
</ol>
<p>The code should look like this:</p>
<pre class="prettyprint source lang-javascript"><code>const fs = require('fs');
const restify = require('restify');
const skype = require('skype-sdk');

const botService = new skype.BotService({
    messaging: {
        botId: '28:&lt;bot’s id>',
        serverUrl : &quot;https://apis.skype.com &quot;,
        requestTimeout : 15000,
        appId: process.env.APP_ID,
        appSecret: process.env.APP_SECRET
    }
});

botService.on('contactAdded', (bot, data) => {
    bot.reply(`Hello ${data.fromDisplayName}!`, true);
});

botService.on('personalMessage', (bot, data) => {
    bot.reply(`Hey ${data.from}. Thank you for your message: &quot;${data.content}&quot;.`, true);
});

const server = restify.createServer();
server.post('/v1/chat', skype.messagingHandler(botService));
const port = process.env.PORT || 8080;
server.listen(port);
console.log('Listening for incoming requests on port ' + port);</code></pre><h2>Start the bot</h2><p>Your bot is ready. Start it and test it locally:</p>
<pre class="prettyprint source"><code>> node server.js</code></pre><p>Make sure you created environment variables:</p>
<ul>
<li>APP_ID With your application ID.</li>
<li>APP_SECRET With your application secret for OAuth.<br>If you don't, your bot won't authenticate and won't be able to call into Skype services.</li>
</ul>
<p>You can also create an environment variable PORT to change the default port 8080. </p>
<p>Finally, if you want to see the debugging messages we added to the code, enter:</p>
<pre class="prettyprint source"><code>> set DEBUG=skype-sdk*</code></pre><h2>Deployment to Azure</h2><p>Follow the <a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-nodejs-develop-deploy-mac/">Create a Node.js web app in Azure App Service</a> article to create your Azure service and deploy it.<br>Go to Azure portal, “App Services”, select your service, “Settings”, “Application settings”, go to “App settings” section and add your environment variables APP_ID and APP_SECRET there. You can also set up the DEBUG variable.</p>
<p>Once your service is deployed to Azure you can start testing the bot with Skype.</p>
<p>If your service is running on Azure, you might want to ensure that you are getting requests really from Bot Platform and not from someone just pretending to be the messaging service. You can use middleware that was created for skype-sdk. Modify your server.js and add following lines after the creation of your server.</p>
<pre class="prettyprint source lang-javascript"><code>const server = restify.createServer();
server.use(skype.ensureHttps(true));
server.use(skype.verifySkypeCert());</code></pre><p>The first middleware, <code>skype.ensureHttps(true)</code> will redirect all requests to https endpoint. If you want to reject them, use <code>skype.ensureHttps(true, 404)</code> to reply with 404 Not Found.</p>
<p>The second middleware, <code>server.use(skype.verifySkypeCert())</code> will allow requests only from Bot Platform. To use it, you need to configure your Azure service to require client certificate. Follow https://azure.microsoft.com/en-gb/documentation/articles/app-service-web-configure-tls-mutual-auth/ to turn on this feature. </p>
<h2>Escaping special characters in messages</h2><p>If your bot fails to send messages, you may have to escape special characters in the content. The rules for replacing characters are:</p>
<ul>
<li>Replace &amp; with <code>&amp;amp;</code></li>
<li>Replace &lt; with <code>&amp;lt;</code></li>
<li>Replace &gt; with <code>&amp;gt;</code></li>
</ul>
<p>This is already done for you in the SDK, there is an <code>escape</code> argument in <code>send()</code> and <code>reply()</code> functions. Set it to true to escape your message.</p>
<h2>Testing with ngrok</h2><p>There are tools that can create a public url to your local webserver on your machine, e.g. <a href="https://ngrok.com/">ngrok</a>. We’ll show how you can test your bot running locally over skype.</p>
<p>You’ll need to download ngrok and modify your bot’s registration.</p>
<p>First step is to start ngrok on your machine and map it to a local http port:</p>
<pre class="prettyprint source"><code>> ngrok http 8000</code></pre><p>This will create a new tunnel from a public url to <a href="http://localhost:8000">http://localhost:8000</a> on your machine. After you start the command, you can see the status of the tunnel:</p>
<pre class="prettyprint source"><code>ngrok by @inconshreveable                                           (Ctrl+C to quit)
Tunnel Status       online
Update              update available (version 2.0.24, Ctrl-U to update)
Version             2.0.19/2.0.25
Web Interface       http://127.0.0.1:4040
Forwarding          http://78191649.ngrok.io -> localhost:8000
Forwarding          https://78191649.ngrok.io -> localhost:8000

Connections     ttl     opn     rt1     rt5     p50     p90
                0       0       0.00    0.00    0.00    0.00</code></pre><p>Notice the “Forwarding” lines, in this case you can see that ngrok created two endpoints for us <a href="http://78191649.ngrok.io">http://78191649.ngrok.io</a> and <a href="http://78191649.ngrok.io">https://78191649.ngrok.io</a> for http and https traffic.</p>
<p>You will now need to configure your Bot to use these endpoints. Don’t forget to append your route when updating the messaging url, the new url should look like this: <a href="https://78191649.ngrok.io/v1/chat">https://78191649.ngrok.io/v1/chat</a></p>
<p>Now you can start your server locally</p>
<pre class="prettyprint source"><code>> node server.js
Listening for incoming requests on port 8000</code></pre><p>And send messages to your bot over skype, they will be sent by Bot Platform to <a href="https://78191649.ngrok.io/v1/chat">https://78191649.ngrok.io/v1/chat</a> and ngrok will forward them to your machine. You just need to keep ngrok running.<br>You will see each request logged in the ngrok’s tunnel status table:</p>
<pre class="prettyprint source"><code>HTTP Requests
-------------

POST /v1/chat                  100 Continue
POST /v1/chat                  201 Created</code></pre><p>If you are done with testing, you can stop ngrok (Ctrl+C), your agent will stop working as there is nothing to forward the requests to your local server.</p>
<p><strong>Note</strong>: Free version of ngrok will create a new unique url for you everytime you start it. That means you always need to go back and update the messaging url for your bot.</p>
<p><strong>Note</strong>: When running locally with ngrok, you need to comment out the call to skype.ensureHttps(true), because your service is not running as https server. </p></article>
    </section>







		</div>
	</div>

	<div class="clearfix"></div>

	
		<div class="col-md-3">
			<div id="toc" class="col-md-3 hidden-xs hidden-sm hidden-md"></div>
		</div>
	

</div>
</div>

<div class="modal fade" id="searchResults">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Search results</h4>
      </div>
      <div class="modal-body"></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>

<footer>


<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a>
	
		on Tue Mar 29th 2016
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>
<script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>

<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			var id = $( heading ).attr( "id" );
			return id && id.replace(/\~/g, '-inner-').replace(/\./g, '-static-') || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->


<script type="text/javascript">
	$(document).ready(function() {
		SearcherDisplay.init();
	});
</script>

</body>
</html>